<!DOCTYPE html>
<html lang="it-IT"><head>
    <title>Gestione della memoria |  C'hi++
</title>
    <meta charset="utf-8" />
    <meta name="viewport"     content="width=device-width, initial-scale=1.0, minimum-scale=1.0" />
    <link rel="canonical"            href="https://chiplusplus.org" />
    <meta     name="thumbnail"       content="https://chiplusplus.org/assets/img/chi-plus-plus.png" />
    <meta     name="keyword"         content="C'hi, C++, c plus plus, religione, open-source" />
    <meta     name="description"     content="Chi++ - Proposta per una metafisica open-source" />
    <meta property="og:title"        content="Gestione della memoria" />
    <meta property="og:type"         content="website" />    
    <meta property="og:description"  content="Chi++ - Proposta per una metafisica open-source" />
    <meta property="og:image"        content="https://chiplusplus.org/assets/img/chi-plus-plus.png" />
    <meta property="og:image:height" content="260" />
    <link rel=icon href=/assets/img/favicon.ico type=image/x-icon>
    <link href="/assets/fa/css/all.css" rel="stylesheet"> 
    <link rel="stylesheet" href="/assets/css/screen.css" ><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-159394431-1');
</script></head>
<body class="manuale capitolo ">

    <div id="page">

        <header><nav class="menu-top">
    
    
    <a href="/man/preprocessore" 
       title="Vai a: Il preprocessore" 
       class="left">
        <i class="fa fa-chevron-left fa-2x" aria-hidden="true"></i>
    </a>
    
    
    <a href="/" class="center" title="Torna alla home-page">
        <i class="fa fa-home fa-2x" aria-hidden="true"></i>
    </a>
    <a href="/man/indice" class="center" title="Torna all'indice del Manuale">
        <i class="fa fa-bars fa-2x" aria-hidden="true"></i>
    </a>

    
    <a href="/man/funzioni" 
       title="Vai a: Le funzioni" 
       class="right" >
            <i class="fa fa-chevron-right  fa-2x" aria-hidden="true"></i>
    </a>
    
    
</nav>
</header>

        <main class="redazione">
            
        

            <h1>
                Gestione della memoria
            </h1>

            <blockquote class="motto">Amiamo ciò che ci ucciderà (se tutto va bene) </blockquote>

            <section id="testo">

                <p>La gestione della memoria è la componente più importante della programmazione.</p>

<p>Come ti ho detto, tutti i linguaggi di programmazione sono un modo di vedere la memoria del computer.
Quando tu <em>dichiari</em> una variabile con un’istruzione come:</p>

<pre><code>int a = 1;
</code></pre>

<p>in realtà, stai dicendo al compilatore di prendere un’area di memoria di 32 bit (un <code>int</code> è grande 4 bytes, ricordi?), associarle il nome <code>a</code> e scriverci dentro il valore binario:</p>

<pre><code> 00000000000000000000000000000001
</code></pre>

<p>Allo stesso modo, se dichiari la stringa:</p>

<pre><code> const char* motto = "Amiamo ciò che ci ucciderà";
</code></pre>

<p>stai chiedendo al compilatore di prendere un’area di memoria di 28 bytes, di associarle il nome <code>motto</code> e scriverci dentro i 27 caratteri della stringa più un ultimo carattere, con valore <code>0</code>, che indica la fine della stringa.<br />
Tutto questo funziona se tu sai in anticipo quanto saranno grandi le variabili con cui avrai a che fare, ma se invece devi gestire dei valori di grandezza variabile, hai due possibilità: o riservi preventivamente una quantità abbondante di spazio, o la allochi sul momento, in base alle tue necessità.
L’allocazione statica va bene se devi gestire pochi dati di dimensioni ridotte, ma se devi gestire molte variabili di grande dimensione, l’allocazione dinamica, anche se più complessa da gestire, è più efficiente.<br />
Il codice seguente è un esempio di gestione statica della memoria:</p>

<pre><code>/** 
 * @file memoria-statica.cpp
 * Gestione statica della memoria.
 */
 
#include &lt;iostream&gt;

/** Definisce la dimensione della stringa */
#define DIM_STRINGA 200

using namespace std;

int main(int argc, char** argv)
{    
    /** Riserva uno spazio di 200 caratteri */
    char stringa[DIM_STRINGA];

    /** 
    * Qui dovrebbe controllare che le stringhe ci siano 
    * e che, sommate, siano più corte di 200 caratteri.. 
    */
    
    /** Copia le stringhe nell'area di memoria */
    sprintf(stringa, "%s %s", argv[1], argv[2]);

    /** Stampa la stringa a video */
    cout &lt;&lt; stringa &lt;&lt; endl;
        
    return 0;
}
       

</code></pre>

<p>Se lo compili e lo esegui, passando due stringhe come parametri, ottieni questo output:</p>

<pre><code>% g++ src/cpp/memoria-statica.cpp -o src/out/esempio                
% src/out/esempio "Amiamo ciò che ci ucciderà" "(se tutto va bene)"
Amiamo ciò che ci ucciderà (se tutto va bene)
</code></pre>

<p>Questo codice funziona se devi gestire solo due stringhe che, sommate, hanno meno di 200 caratteri: una condizione piuttosto restrittiva.
Puoi aumentare il numero di stringhe e la dimensione dello spazio in memoria, ma otterresti un programma che è o sovra o sotto dimensionato.
Questa non è buona programmazione.
Il buon programmatore non deve sprecare risorse; per lui, il proverbiale bicchiere non è né mezzo pieno né mezzo vuoto: è grande il doppio del necessario.</p>

<pre><code>/** 
 * @file memoria-dinamica.cpp
 * Gestione dinamica della memoria.
 */
 
#include &lt;iostream&gt;


using namespace std;

int main(int argc, char** argv)
{    
    /** 
    * Qui dovrebbe controllare che le stringhe ci siano.. 
    */
   
    /** Legge la lunghezza delle due stringhe */        
    size_t len1 = strlen(argv[1]);
    size_t len2 = strlen(argv[2]);

    /** 
     * Alloca un'area di memoria grande quanto le due
     * stringhe più un carattere di spazio e un
     * carattere terminatore.
     */   
    size_t lunghezza = len1 + len2 + 2; 
    char* stringa = new char(lunghezza);

    /** Copia le stringhe nell'area di memoria */
    sprintf(stringa, "%s %s", argv[1], argv[2]);

    /** Mostra la dimensione dell'area e la stringa */
    cout &lt;&lt; lunghezza &lt;&lt; " - " &lt;&lt; stringa &lt;&lt; endl;
    
    /** Libera la memoria allocata */
    delete stringa;
    
    return 0;
}
       

</code></pre>

<p>L’output di questo programma, molto più parsimonioso della sua versione statica, è il seguente:</p>

<pre><code>% src/out/esempio "Amiamo ciò che ci ucciderà" "(se tutto va bene)"                              
48 - Amiamo ciò che ci ucciderà (se tutto va bene)
% src/out/esempio "Amiamo ciò che ci ucciderà" "(se tutto va bene, cosa che non si può mai dire)"
79 - Amiamo ciò che ci ucciderà (se tutto va bene, cosa che non si può mai dire)
% src/out/esempio "Amiamo ciò che ci ucciderà" ""            
30 - Amiamo ciò che ci ucciderà 
</code></pre>

<!--

@todo: spiegare la differenza fra dichiarazione e definizione; parlare della parola-chiave extern

Utlizzare l'peratore `delete` per illustrare il rapporto del C’hi++ con la morte, che non è più considerata un nemico da combattere, ma un fenomeno naturale necessario al buon funzonamento dell’Universo. 
Questo approccio si rirova anche nel precetto:

    Amiamo ciò che ci ucciderà (se tutto va bene) 

Introdurre il concetto di visibilità delle variabili, che serve in seguito per i PostIt.

Questo è anche il capitolo in cui parlare della posizione di un certo dato in memoria, che può variare in successive esecuzioni del programma.
Allo stesso modo, l'io cosciente di ciascuno di noi non è detto che si manifesterà nello stesso individuo, ma potrà essere "allocato" in altri esseri

-->


            </section>
            
        

        
        </main>

        <footer>
    <nav>
        
        
        <a href="/man/preprocessore" 
           title="Vai a: Il preprocessore" 
           class="left">
            <i class="fa fa-chevron-left fa-2x" aria-hidden="true"></i>
        </a>
        
        
        <a href="#top" 
           title="Torna all'inizio" >
           <i class="fa fa-angle-double-up fa-2x" aria-hidden="true"></i>
        </a>

        
        <a href="/man/funzioni" 
           title="Vai a: Le funzioni" 
           class="right" >
                <i class="fa fa-chevron-right  fa-2x" aria-hidden="true"></i>
        </a>
                

    </nav>

</footer>


    </div>

  </body>

</html>
